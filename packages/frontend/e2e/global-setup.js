const { chromium } = require('@playwright/test');\nconst path = require('path');\nconst fs = require('fs');\n\n// Global setup function\nasync function globalSetup(config) {\n  console.log('ğŸš€ Starting global test setup...');\n  \n  try {\n    // Create test artifacts directory\n    const artifactsDir = path.resolve(process.cwd(), 'playwright-artifacts');\n    if (!fs.existsSync(artifactsDir)) {\n      fs.mkdirSync(artifactsDir, { recursive: true });\n      console.log('ğŸ“ Created artifacts directory');\n    }\n    \n    // Create test data directory\n    const testDataDir = path.resolve(process.cwd(), 'e2e/test-data');\n    if (!fs.existsSync(testDataDir)) {\n      fs.mkdirSync(testDataDir, { recursive: true });\n      console.log('ğŸ“ Created test data directory');\n    }\n    \n    // Wait for web servers to be ready\n    console.log('â³ Waiting for web servers to be ready...');\n    \n    const browser = await chromium.launch();\n    const context = await browser.newContext();\n    const page = await context.newPage();\n    \n    try {\n      // Check frontend server\n      console.log('ğŸ” Checking frontend server...');\n      await page.goto(config.use.baseURL || 'http://localhost:3000', {\n        timeout: 30000,\n        waitUntil: 'networkidle'\n      });\n      console.log('âœ… Frontend server is ready');\n      \n      // Check backend API server\n      console.log('ğŸ” Checking backend API server...');\n      const apiUrl = process.env.API_URL || 'http://localhost:3001';\n      \n      try {\n        const response = await page.request.get(`${apiUrl}/api/health`);\n        if (response.ok()) {\n          console.log('âœ… Backend API server is ready');\n        } else {\n          console.log('âš ï¸  Backend API server responded with status:', response.status());\n        }\n      } catch (apiError) {\n        console.log('âš ï¸  Backend API server check failed:', apiError.message);\n        \n        // Try basic tasks endpoint as fallback\n        try {\n          await page.request.get(`${apiUrl}/api/tasks`);\n          console.log('âœ… Backend API tasks endpoint is accessible');\n        } catch (tasksError) {\n          console.warn('âŒ Backend API is not accessible:', tasksError.message);\n        }\n      }\n      \n    } finally {\n      await context.close();\n      await browser.close();\n    }\n    \n    // Initialize test database\n    console.log('ğŸ—„ï¸  Initializing test database...');\n    await initializeTestDatabase();\n    \n    // Set up test environment variables\n    process.env.NODE_ENV = 'test';\n    process.env.TEST_MODE = 'true';\n    \n    console.log('ğŸ‰ Global setup completed successfully!');\n    \n  } catch (error) {\n    console.error('âŒ Global setup failed:', error);\n    throw error;\n  }\n}\n\n// Initialize test database with clean state\nasync function initializeTestDatabase() {\n  try {\n    const apiUrl = process.env.API_URL || 'http://localhost:3001';\n    \n    // Launch browser to perform API calls\n    const browser = await chromium.launch();\n    const context = await browser.newContext();\n    const page = await context.newPage();\n    \n    try {\n      // Clear any existing test data\n      await page.request.delete(`${apiUrl}/api/tasks/test-cleanup`, {\n        headers: { 'Content-Type': 'application/json' },\n        data: { confirm: true }\n      }).catch(() => {\n        // Ignore if endpoint doesn't exist\n        console.log('ğŸ“ Test cleanup endpoint not available, skipping...');\n      });\n      \n      console.log('ğŸ§¹ Test database initialized');\n      \n    } finally {\n      await context.close();\n      await browser.close();\n    }\n    \n  } catch (error) {\n    console.warn('âš ï¸  Could not initialize test database:', error.message);\n    // Don't fail setup if database initialization fails\n  }\n}\n\nmodule.exports = globalSetup;