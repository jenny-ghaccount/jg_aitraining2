const { defineConfig, devices } = require('@playwright/test');\n\n/**\n * @see https://playwright.dev/docs/test-configuration\n */\nmodule.exports = defineConfig({\n  testDir: './e2e',\n  \n  /* Run tests in files in parallel */\n  fullyParallel: true,\n  \n  /* Fail the build on CI if you accidentally left test.only in the source code. */\n  forbidOnly: !!process.env.CI,\n  \n  /* Retry on CI only */\n  retries: process.env.CI ? 2 : 0,\n  \n  /* Opt out of parallel tests on CI. */\n  workers: process.env.CI ? 1 : undefined,\n  \n  /* Reporter to use. See https://playwright.dev/docs/test-reporters */\n  reporter: [\n    ['html'],\n    ['json', { outputFile: 'playwright-report/results.json' }],\n    ['junit', { outputFile: 'playwright-report/results.xml' }],\n    process.env.CI ? ['github'] : ['list']\n  ],\n  \n  /* Shared settings for all the projects below. See https://playwright.dev/docs/api/class-testoptions. */\n  use: {\n    /* Base URL to use in actions like `await page.goto('/')`. */\n    baseURL: process.env.TEST_URL || 'http://localhost:3000',\n    \n    /* Collect trace when retrying the failed test. See https://playwright.dev/docs/trace-viewer */\n    trace: 'on-first-retry',\n    \n    /* Capture screenshot on failure */\n    screenshot: 'only-on-failure',\n    \n    /* Capture video on failure */\n    video: 'retain-on-failure',\n    \n    /* Timeout for each action */\n    actionTimeout: 10000,\n    \n    /* Timeout for navigation actions */\n    navigationTimeout: 30000,\n    \n    /* Global test timeout */\n    testTimeout: 60000,\n  },\n\n  /* Configure projects for major browsers */\n  projects: [\n    {\n      name: 'chromium',\n      use: { ...devices['Desktop Chrome'] },\n    },\n    \n    {\n      name: 'firefox',\n      use: { ...devices['Desktop Firefox'] },\n    },\n    \n    {\n      name: 'webkit',\n      use: { ...devices['Desktop Safari'] },\n    },\n    \n    /* Test against mobile viewports. */\n    {\n      name: 'Mobile Chrome',\n      use: { ...devices['Pixel 5'] },\n    },\n    \n    {\n      name: 'Mobile Safari',\n      use: { ...devices['iPhone 12'] },\n    },\n    \n    /* Test against tablet viewports */\n    {\n      name: 'iPad',\n      use: { ...devices['iPad Pro'] },\n    },\n    \n    /* High DPI display testing */\n    {\n      name: 'chromium-hidpi',\n      use: { \n        ...devices['Desktop Chrome'],\n        deviceScaleFactor: 2\n      },\n    },\n    \n    /* Accessibility testing with screen reader simulation */\n    {\n      name: 'accessibility',\n      use: {\n        ...devices['Desktop Chrome'],\n        // Simulate screen reader preferences\n        extraHTTPHeaders: {\n          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36 ScreenReader/1.0'\n        },\n        // Enable accessibility tree in tests\n        contextOptions: {\n          hasTouch: false,\n          isMobile: false,\n        }\n      },\n      testMatch: '**/accessibility.spec.js'\n    },\n    \n    /* Performance testing */\n    {\n      name: 'performance',\n      use: {\n        ...devices['Desktop Chrome'],\n        // Slower CPU for performance testing\n        launchOptions: {\n          args: ['--cpu-throttling-rate=4']\n        }\n      },\n      testMatch: '**/performance.spec.js'\n    },\n    \n    /* Cross-browser compatibility testing */\n    {\n      name: 'edge',\n      use: { \n        ...devices['Desktop Edge'],\n        channel: 'msedge'\n      },\n    }\n  ],\n\n  /* Global setup and teardown */\n  globalSetup: require.resolve('./e2e/global-setup.js'),\n  globalTeardown: require.resolve('./e2e/global-teardown.js'),\n\n  /* Web server configuration */\n  webServer: [\n    {\n      command: 'npm run start',\n      url: 'http://localhost:3000',\n      timeout: 120 * 1000,\n      reuseExistingServer: !process.env.CI,\n      cwd: './packages/frontend'\n    },\n    {\n      command: 'npm run start',\n      url: 'http://localhost:3001/api/health',\n      timeout: 120 * 1000,\n      reuseExistingServer: !process.env.CI,\n      cwd: './packages/backend'\n    }\n  ],\n  \n  /* Expect configuration */\n  expect: {\n    /* Timeout for assertions */\n    timeout: 10000,\n    \n    /* Threshold for image comparisons */\n    threshold: 0.2,\n    \n    /* Exact text matching by default */\n    toMatchSnapshot: {\n      threshold: 0.2,\n      mode: 'percent'\n    }\n  },\n  \n  /* Output directory for test artifacts */\n  outputDir: 'playwright-results/',\n  \n  /* Directory for test artifacts like screenshots, videos, traces */\n  testArtifacts: {\n    mode: 'retain-on-failure',\n    path: 'playwright-artifacts/'\n  }\n});